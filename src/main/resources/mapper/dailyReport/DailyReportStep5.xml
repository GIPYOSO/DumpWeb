<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dispatch.dump.commonModule.db.mapper.DailyReportStep5Mapper">

    <!--차계부 내용 저장-->
    <insert id="insertDailyReportStep5" parameterType="DailyReportStep5">
        INSERT INTO tdrive
        (driveid,
         carno,
         drvdate,
         lastkm,
         drvclub,
         useamt,
         useoil,
         drvrem,
         chk2,
         drivess)
        VALUES      ( # {driveID},
                      # {carNo},
                      # {drvDate},
                      # {lastKm},
                      # {drvClub},
                      # {useAmt},
                      # {useOil},
                      # {drvRem},
                      # {chk2},
                      (SELECT uuserid
                       FROM   tsitepw
                       WHERE  userid = # {carNo}))
    </insert>


    <!--차계부 내용 업데이트-->
    <update id="updateDailyReportStep5" parameterType="DailyReportStep5">
        UPDATE tdrive
        SET    drvdate=IF(#{drvdate} IS NOT NULL,#{drvdate}, getdate()),
               drvclub=IF(#{drvclub} IS NOT NULL,#{drvdate}, '요소수'),
               lastkm = IF(#{lastkm} IS NOT NULL,#{lastkm}, NULL),
               useoil = IF(#{useoil} IS NOT NULL,#{useoil}, NULL),
               drvrem = IF(#{drvrem} IS NOT NULL,#{drvrem}, NULL),
               chk2 = IF(#{chk2} IS NOT NULL,#{chk2}, 0),
               WHERE  driveid=#{driveid}
    </update>


    <select id="findCarListByDate" resultType="DailyReportStep5">
        SELECT driveID,
        DATE_FORMAT(drvdate, '%m.%d') AS 'drvdate',
        drvclub,
        chk2,
        lastkm,
        useamt,
        useOil,
        drvrem,
        rependchk,
        IF(rependdate IS NULL, '1999-01-01',rependdate) AS 'rependdate',
        repaddkm
        FROM   tdrive
        WHERE  carno = #{userID}
        AND drvdate LIKE CONCAT(#{date}, '%')
        ORDER BY drvclub ASC
    </select>

    <select id="findDriveIDForm" resultType="DailyReportStep5">
        SELECT driveID,
               DATE_FORMAT(drvdate, '%Y-%m-%d') AS 'drvdate',
               drvclub,
               chk2,
               lastkm,
               useamt,
               useOil,
               drvrem,
               IF(rependdate IS NULL, '1999-01-01',rependdate) AS 'rependdate',
               repaddkm,
               rependchk
        FROM   tdrive
        WHERE  carno = #{userID}
          AND driveID = #{driveID}
    </select>

</mapper>